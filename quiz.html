<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FutureProof Navigator - Quiz de Impacto da IA</title>
    <link rel="stylesheet" href="css/style.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">
</head>
<body>
<header>
    <div class="container">
        <div class="logo">FutureProof Navigator</div>
        <nav>
            <ul>
                <li><a href="index.html">Home</a></li>
                <li><a href="index.html#problem">O Problema</a></li>
                <li><a href="index.html#solution">Soluções</a></li>
                <li><a href="index.html#contact">Contato</a></li>
            </ul>
        </nav>
    </div>
</header>

<section class="quiz-section">
    <div class="container">
        <div class="quiz-content">
            <h1>Quiz de Impacto da IA</h1>
            <p class="subtitle">Responda às perguntas para avaliar o impacto da IA na sua área.</p>

            <div class="quiz-container">
                <div id="lead-gate" style="margin-bottom:16px;">
                    <h3 style="margin-bottom:8px;">Antes de começar</h3>
                    <div style="display:flex; gap:8px; flex-wrap:wrap;">
                        <input id="lead-name" type="text" placeholder="Seu nome" aria-label="Seu nome" style="flex:1; min-width:220px; padding:10px;">
                        <input id="lead-email" type="email" placeholder="Seu e-mail" aria-label="Seu e-mail" style="flex:1; min-width:260px; padding:10px;">
                        <button class="btn-primary" onclick="startQuizFromLead()">Começar quiz</button>
                    </div>
                    <p id="lead-gate-msg" class="subtitle" style="margin-top:6px; color:#7f8c8d;">Informe nome e e‑mail para personalizarmos seu relatório ao final.</p>
                </div>

                <div class="quiz-progress" id="quiz-progress" style="display:none;">
                    <div class="progress-bar">
                        <div id="progress-fill" role="progressbar" aria-label="Progresso do quiz" aria-valuemin="0" aria-valuemax="8" aria-valuenow="1" style="width: 0%"></div>
                    </div>
                    <span id="progress-text">Pergunta 1 de 8</span>
                </div>

                <div id="question-container" aria-live="polite" style="display:none;"></div>
                <div id="options-container" role="radiogroup" aria-labelledby="question-title" style="display:none;"></div>

                <div class="quiz-navigation">
                    <button id="prev-btn" class="btn-primary" onclick="prevQuestion()">Retornar</button>
                    <button id="next-btn" class="btn-primary" onclick="nextQuestion()">Avançar</button>
                    <button id="submit-quiz" class="btn-primary" style="display:none;" onclick="submitQuiz()">Ver Meu Score de Impacto</button>
                </div>
                <div id="closing-message" style="display:none; margin-top: 10px; font-weight:600; color:#2c3e50;">Você chegou ao fim do quiz. Para ver seu score e acessar o relatório de pesquisa, finalize abaixo.</div>
                <div id="results-container" style="display:none; margin-top:20px;">
                    <h3>Seu Score de Impacto da IA</h3>
                    <p id="score-text" class="subtitle" style="margin-top:8px; margin-bottom:16px;"></p>
                    <button id="report-cta" class="btn-primary" onclick="sendReportOptIn()" style="display:inline-block; margin-right:10px;">Receber relatório por e‑mail</button>
                    <button class="btn-secondary" onclick="sharePage()">Compartilhar com um colega</button>
                </div>
            </div>
        </div>
    </div>
</section>

<footer>
    <div class="container">
        <p>&copy; 2025 FutureProof Navigator. Todos os direitos reservados.</p>
    </div>
</footer>

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script>
    window.SUPABASE_URL = "https://nycvzzbptvvmlwzujxws.supabase.co";
    window.SUPABASE_ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im55Y3Z6emJwdHZ2bWx3enVqeHdzIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjExNTIwMDcsImV4cCI6MjA3NjcyODAwN30.QfZcBl95o-hQhLigKWettH93TyIxMVana4sQl45O8y8";
</script>
<script>
    let currentQuestion = 0;
    let responses = {};
    let selectedArea = "";
    // Lead gate
    let leadName = "";
    let leadEmail = "";
    // Últimos resultados calculados
    let lastIaScore = null;
    let lastSegmentScore = null;
    let lastSegmentGroup = null;
    let lastCustomerSegment = null;

    const quizData = {
    tecnologia: [
        { q: "Qual ferramenta de IA você utiliza mais frequentemente?", options: ["ChatGPT ou Copilot", "Ferramentas de análise de dados", "Não utilizo", "Outra ferramenta"] },
        { q: "Qual é o seu maior receio em relação à IA?", options: ["Perda do emprego", "Obsolecência de habilidades", "Falta de tempo para aprendizado", "Outro motivo"] },
        { q: "Qual é o seu nível atual de programação?", options: ["Iniciante", "Intermediário", "Avançado", "Especialista"] },
        { q: "Quanto você está disposto a investir mensalmente em aprendizado?", options: ["Nada", "Até R$100", "Entre R$101 e R$300", "Mais de R$300"] },
        { q: "Qual é a sua urgência em se adaptar à IA?", options: ["Imediata", "Nos próximos 6 meses", "Nos próximos 12 meses", "Não urgente"] },
        { q: "Qual habilidade você mais deseja aprimorar?", options: ["Inteligência Artificial/Machine Learning", "Cloud Computing", "Cibersegurança", "DevOps"] },
        { q: "Como você avalia o impacto atual da IA na sua área?", options: ["Alto", "Moderado", "Baixo", "Nenhum"] },
        { q: "Qual é a maior barreira para aprender novas tecnologias?", options: ["Custo", "Falta de tempo", "Complexidade", "Falta de motivação"] }
    ],
    publicidade: [
        { q: "Qual ferramenta de IA você utiliza mais frequentemente?", options: ["ChatGPT para redação", "Análise de público-alvo", "Design automatizado", "Não utilizo"] },
        { q: "Qual é o seu maior receio em relação à IA?", options: ["Perda de criatividade", "Automação de campanhas", "Redução de demanda", "Outro motivo"] },
        { q: "Qual é o seu nível atual de análise de dados?", options: ["Básico", "Intermediário", "Avançado", "Especialista"] },
        { q: "Quanto você está disposto a investir mensalmente em aprendizado?", options: ["Nada", "Até R$100", "Entre R$101 e R$300", "Mais de R$300"] },
        { q: "Qual é a sua urgência em se adaptar à IA?", options: ["Imediata", "Nos próximos 6 meses", "Nos próximos 12 meses", "Não urgente"] },
        { q: "Qual é o seu foco principal no trabalho?", options: ["Criação de conteúdo", "Mídia paga", "Estratégia", "Mídias sociais"] },
        { q: "Como você avalia o impacto atual da IA na sua área?", options: ["Alto", "Moderado", "Baixo", "Nenhum"] },
        { q: "Qual é a maior barreira para aprender novas tecnologias?", options: ["Custo", "Falta de tempo", "Complexidade", "Falta de motivação"] }
    ],
    financas: [
        { q: "Qual ferramenta financeira você utiliza mais frequentemente?", options: ["Excel avançado", "Python ou R", "Power BI", "Não utilizo"] },
        { q: "Qual é o seu maior receio em relação à IA?", options: ["Automação de análises", "Perda de precisão", "Falta de controle", "Outro motivo"] },
        { q: "Qual é o seu nível atual de modelagem financeira?", options: ["Básico", "Intermediário", "Avançado", "Especialista"] },
        { q: "Quanto você está disposto a investir mensalmente em aprendizado?", options: ["Nada", "Até R$100", "Entre R$101 e R$300", "Mais de R$300"] },
        { q: "Qual é a sua urgência em se adaptar à IA?", options: ["Imediata", "Nos próximos 6 meses", "Nos próximos 12 meses", "Não urgente"] },
        { q: "Qual área de interesse domina seu trabalho?", options: ["Investimentos", "Gestão de riscos", "Fintech", "Compliance"] },
        { q: "Como você avalia o impacto atual da IA na sua área?", options: ["Alto", "Moderado", "Baixo", "Nenhum"] },
        { q: "Qual é a maior barreira para aprender novas tecnologias?", options: ["Custo", "Falta de tempo", "Complexidade", "Falta de motivação"] }
    ],
    construcao: [
        { q: "Qual software você utiliza mais frequentemente?", options: ["AutoCAD ou Revit", "Excel", "ERP", "Não utilizo"] },
        { q: "Qual é o seu maior receio em relação à IA?", options: ["Automação de projetos", "Redução de mão de obra", "Custo de adoção", "Outro motivo"] },
        { q: "Qual é o seu nível atual de gestão de projetos?", options: ["Básico", "Intermediário", "Avançado", "Especialista"] },
        { q: "Quanto você está disposto a investir mensalmente em aprendizado?", options: ["Nada", "Até R$100", "Entre R$101 e R$300", "Mais de R$300"] },
        { q: "Qual é a sua urgência em se adaptar à IA?", options: ["Imediata", "Nos próximos 6 meses", "Nos próximos 12 meses", "Não urgente"] },
        { q: "Qual é a sua área de foco principal?", options: ["Planejamento", "Execução", "Manutenção", "Orçamentos"] },
        { q: "Como você avalia o impacto atual da IA na sua área?", options: ["Alto", "Moderado", "Baixo", "Nenhum"] },
        { q: "Qual é a maior barreira para aprender novas tecnologias?", options: ["Custo", "Falta de tempo", "Complexidade", "Falta de motivação"] }
    ],
    saude: [
        { q: "Qual ferramenta de IA você utiliza mais frequentemente?", options: ["Sistemas de diagnóstico", "Análise de dados", "Não utilizo", "Outra ferramenta"] },
        { q: "Qual é o seu maior receio em relação à IA?", options: ["Erro médico", "Perda de humanização", "Questões regulatórias", "Outro motivo"] },
        { q: "Qual é o seu nível de uso de tecnologia na saúde?", options: ["Básico", "Intermediário", "Avançado", "Especialista"] },
        { q: "Quanto você está disposto a investir mensalmente em aprendizado?", options: ["Nada", "Até R$100", "Entre R$101 e R$300", "Mais de R$300"] },
        { q: "Qual é a sua urgência em se adaptar à IA?", options: ["Imediata", "Nos próximos 6 meses", "Nos próximos 12 meses", "Não urgente"] },
        { q: "Qual é a sua área de foco principal?", options: ["Diagnóstico", "Tratamento", "Administração", "Pesquisa"] },
        { q: "Como você avalia o impacto atual da IA na sua área?", options: ["Alto", "Moderado", "Baixo", "Nenhum"] },
        { q: "Qual é a maior barreira para aprender novas tecnologias?", options: ["Custo", "Falta de tempo", "Complexidade", "Falta de motivação"] }
    ],
    educacao: [
        { q: "Qual ferramenta de IA você utiliza mais frequentemente?", options: ["Plataformas EAD", "Avaliação automática", "Não utilizo", "Outra ferramenta"] },
        { q: "Qual é o seu maior receio em relação à IA?", options: ["Substituição de professores", "Falta de personalização", "Acesso desigual", "Outro motivo"] },
        { q: "Qual é o seu nível de uso de tecnologia educacional?", options: ["Básico", "Intermediário", "Avançado", "Especialista"] },
        { q: "Quanto você está disposto a investir mensalmente em aprendizado?", options: ["Nada", "Até R$100", "Entre R$101 e R$300", "Mais de R$300"] },
        { q: "Qual é a sua urgência em se adaptar à IA?", options: ["Imediata", "Nos próximos 6 meses", "Nos próximos 12 meses", "Não urgente"] },
        { q: "Qual é a sua área de foco principal?", options: ["Ensino", "Gestão", "Pesquisa", "Treinamento"] },
        { q: "Como você avalia o impacto atual da IA na sua área?", options: ["Alto", "Moderado", "Baixo", "Nenhum"] },
        { q: "Qual é a maior barreira para aprender novas tecnologias?", options: ["Custo", "Falta de tempo", "Complexidade", "Falta de motivação"] }
    ],
    industria: [
        { q: "Qual tecnologia você usa mais na operação?", options: ["Automação/Robótica", "IoT/Sensores", "ERP/MES", "Não utilizo"] },
        { q: "Qual é seu maior receio com IA na indústria?", options: ["Substituição de funções", "Paradas não planejadas", "Custo de implementação", "Outro motivo"] },
        { q: "Qual é o seu nível atual de manutenção preditiva?", options: ["Básico", "Intermediário", "Avançado", "Especialista"] },
        { q: "Investimento mensal possível em eficiência/IA?", options: ["Nada", "Até R$100", "Entre R$101 e R$300", "Mais de R$300"] },
        { q: "Qual urgência em digitalizar processos?", options: ["Imediata", "Nos próximos 6 meses", "Nos próximos 12 meses", "Não urgente"] },
        { q: "Onde está o foco principal?", options: ["Produção", "Qualidade", "Manutenção", "Logística"] },
        { q: "Impacto atual da IA na sua operação", options: ["Alto", "Moderado", "Baixo", "Nenhum"] },
        { q: "Maior barreira hoje", options: ["Custo", "Falta de tempo", "Complexidade", "Falta de motivação"] }
    ],
    servicos: [
        { q: "Qual ferramenta de IA usa no atendimento?", options: ["Chatbots", "Análise de dados", "Automação de processos", "Não utilizo"] },
        { q: "Maior receio com IA em serviços", options: ["Perda de qualidade", "Automação excessiva", "Redução de demanda", "Outro motivo"] },
        { q: "Nível atual de digitalização", options: ["Básico", "Intermediário", "Avançado", "Especialista"] },
        { q: "Investimento mensal em melhoria", options: ["Nada", "Até R$100", "Entre R$101 e R$300", "Mais de R$300"] },
        { q: "Urgência em adotar IA", options: ["Imediata", "Nos próximos 6 meses", "Nos próximos 12 meses", "Não urgente"] },
        { q: "Foco principal no negócio", options: ["Atendimento", "Operações", "Marketing", "Financeiro"] },
        { q: "Impacto atual da IA", options: ["Alto", "Moderado", "Baixo", "Nenhum"] },
        { q: "Maior barreira hoje", options: ["Custo", "Falta de tempo", "Complexidade", "Falta de motivação"] }
    ],
    comercio: [
        { q: "Qual tecnologia usa mais no comércio?", options: ["E-commerce/Marketplace", "CRM/POS", "Análise de estoque", "Não utilizo"] },
        { q: "Maior receio com IA no comércio", options: ["Queda de margens", "Automação de marketing", "Previsão de demanda", "Outro motivo"] },
        { q: "Nível atual de canais digitais", options: ["Básico", "Intermediário", "Avançado", "Especialista"] },
        { q: "Investimento mensal em tecnologia", options: ["Nada", "Até R$100", "Entre R$101 e R$300", "Mais de R$300"] },
        { q: "Urgência para modernizar vendas", options: ["Imediata", "Nos próximos 6 meses", "Nos próximos 12 meses", "Não urgente"] },
        { q: "Foco principal", options: ["Aquisição", "Retenção", "Operação/Logística", "Preço/Promoção"] },
        { q: "Impacto atual da IA", options: ["Alto", "Moderado", "Baixo", "Nenhum"] },
        { q: "Maior barreira hoje", options: ["Custo", "Falta de tempo", "Complexidade", "Falta de motivação"] }
    ],
    governo: [
        { q: "Uso de tecnologia no órgão", options: ["Análise de dados", "Automação de processos", "Atendimento digital", "Não utilizo"] },
        { q: "Maior receio com IA no setor público", options: ["Privacidade", "Confiabilidade", "Custo/Compliance", "Outro motivo"] },
        { q: "Nível de transformação digital", options: ["Básico", "Intermediário", "Avançado", "Especialista"] },
        { q: "Investimento mensal possível", options: ["Nada", "Até R$100", "Entre R$101 e R$300", "Mais de R$300"] },
        { q: "Urgência de adoção de IA", options: ["Imediata", "Nos próximos 6 meses", "Nos próximos 12 meses", "Não urgente"] },
        { q: "Área de foco", options: ["Atendimento", "Fiscalização", "Operações", "Transparência"] },
        { q: "Impacto atual da IA", options: ["Alto", "Moderado", "Baixo", "Nenhum"] },
        { q: "Maior barreira hoje", options: ["Custo", "Falta de tempo", "Complexidade", "Falta de motivação"] }
    ],
    outra: [
        { q: "Qual ferramenta de IA você utiliza mais frequentemente?", options: ["ChatGPT", "Análise de dados", "Automação", "Não utilizo"] },
        { q: "Qual é o seu maior receio em relação à IA?", options: ["Incerteza geral", "Perda de controle", "Falta de recursos", "Outro motivo"] },
        { q: "Qual é o seu nível técnico atual?", options: ["Básico", "Intermediário", "Avançado", "Especialista"] },
        { q: "Quanto você está disposto a investir mensalmente em aprendizado?", options: ["Nada", "Até R$100", "Entre R$101 e R$300", "Mais de R$300"] },
        { q: "Qual é a sua urgência em se adaptar à IA?", options: ["Imediata", "Nos próximos 6 meses", "Nos próximos 12 meses", "Não urgente"] },
        { q: "Qual é o seu maior desafio atual no trabalho?", options: ["Falta de tempo", "Custo", "Complexidade", "Falta de motivação"] },
        { q: "Como você avalia o impacto atual da IA na sua área?", options: ["Alto", "Moderado", "Baixo", "Nenhum"] },
        { q: "Qual é a maior barreira para aprender novas tecnologias?", options: ["Custo", "Falta de tempo", "Complexidade", "Falta de motivação"] }
    ]
    };

    function loadQuestion() {
        const questionContainer = document.getElementById("question-container");
        const optionsContainer = document.getElementById("options-container");
        const prevBtn = document.getElementById("prev-btn");
        const nextBtn = document.getElementById("next-btn");
        const submitBtn = document.getElementById("submit-quiz");

        // --- ETAPA INICIAL: SELEÇÃO DE ÁREA ---
        if (!selectedArea) {
            document.getElementById('lead-gate').style.display = 'block';
            document.getElementById('quiz-progress').style.display = 'none';
            questionContainer.style.display = 'block';
            document.getElementById('options-container').style.display = 'block';
            questionContainer.innerHTML = "<h3>Selecione sua área de atuação</h3>";

            const areas = [
                { value: "tecnologia", label: "Tecnologia" },
                { value: "publicidade", label: "Publicidade / Marketing" },
                { value: "financas", label: "Finanças" },
                { value: "construcao", label: "Construção Civil" },
                { value: "saude", label: "Saúde" },
                { value: "educacao", label: "Educação" },
                { value: "industria", label: "Indústria" },
                { value: "servicos", label: "Serviços" },
                { value: "comercio", label: "Comércio" },
                { value: "governo", label: "Governo" },
                { value: "outra", label: "Outra" }
            ];

            optionsContainer.innerHTML = areas.map(a => `
                <label class="quiz-choice ${selectedArea === a.value ? 'selected' : ''}" 
                    onclick="selectArea('${a.value}', this)">
                    <input type="radio" name="area" value="${a.value}">
                    <span class="checkmark"></span>
                    ${a.label}
                </label>
            `).join('');

        const qt = document.getElementById('question-title');
        if (qt) qt.focus();

            // Botões desativados no início
            prevBtn.classList.add("btn-disabled");
            nextBtn.classList.add("btn-disabled");
            submitBtn.style.display = "none";
            return;
        }

        // --- QUESTÕES DO QUIZ ---
        const currentQuiz = quizData[selectedArea][currentQuestion];
        document.getElementById('lead-gate').style.display = 'none';
        document.getElementById('quiz-progress').style.display = 'block';
        questionContainer.style.display = 'block';
        document.getElementById('options-container').style.display = 'block';
        document.getElementById("progress-text").textContent = `Pergunta ${currentQuestion + 1} de 8`;
        document.getElementById("progress-fill").style.width = `${((currentQuestion + 1) / 8) * 100}%`;
        document.getElementById("progress-fill").setAttribute('aria-valuenow', String(currentQuestion + 1));

        questionContainer.innerHTML = `<h3 id="question-title" tabindex="-1">${currentQuiz.q}</h3>`;
        optionsContainer.innerHTML = currentQuiz.options.map(opt => `
            <label class="quiz-choice ${responses[`q${currentQuestion}`] === opt ? 'selected' : ''}"
                data-opt="${encodeURIComponent(opt)}"
                onclick="selectAnswer(${currentQuestion}, this.dataset.opt, this)">
                <input type="radio" name="q${currentQuestion}" value="${opt}">
                <span class="checkmark"></span>
                ${opt}
            </label>
        `).join('');

        // Defesa adicional: garante captura via change nos radios
        optionsContainer.querySelectorAll(`input[name="q${currentQuestion}"]`).forEach(function(input){
            input.addEventListener('change', function(){
                const lbl = this.parentElement;
                const opt = encodeURIComponent(this.value);
                selectAnswer(currentQuestion, opt, lbl);
            });
        });

        // Botão "Retornar" ativo desde a 1ª pergunta e com estilo verde
        prevBtn.classList.remove("btn-disabled");
        prevBtn.classList.remove("btn-secondary");
        prevBtn.classList.add("btn-primary");

        // Controla "Avançar" e "Enviar"
        nextBtn.classList.toggle("btn-disabled", !responses[`q${currentQuestion}`]);
        if (currentQuestion === quizData[selectedArea].length - 1) {
            nextBtn.style.display = "none";
            submitBtn.style.display = "inline-block";
        } else {
            nextBtn.style.display = "inline-block";
            submitBtn.style.display = "none";
        }
        // Garante que o botão Avançar chame nextQuestion durante as perguntas
        nextBtn.onclick = nextQuestion;
        // Oculta mensagem de fechamento e resultados ao navegar
        document.getElementById("closing-message").style.display = "none";
        document.getElementById("results-container").style.display = "none";
    }

    function selectArea(areaValue, labelEl) {
        selectedArea = areaValue;
        document.querySelectorAll(".quiz-choice").forEach(el => el.classList.remove("selected"));
        labelEl.classList.add("selected");
        const nextBtn = document.getElementById("next-btn");
        nextBtn.classList.remove("btn-disabled");
        nextBtn.onclick = function() {
            currentQuestion = 0;
            loadQuestion();
        };
    }

    function selectAnswer(questionIndex, option, labelEl) {
        const decoded = decodeURIComponent(option || '');
        responses[`q${questionIndex}`] = decoded;
        document.querySelectorAll(`[name='q${questionIndex}']`).forEach(el => el.parentElement.classList.remove('selected'));
        labelEl.classList.add('selected');

        // Habilita "Avançar" automaticamente após seleção
        const nextBtn = document.getElementById("next-btn");
        nextBtn.classList.remove("btn-disabled");
        nextBtn.style.display = "inline-block";
        nextBtn.onclick = nextQuestion;
    }

    function prevQuestion() {
        if (currentQuestion > 0) {
            currentQuestion--;
            loadQuestion();
        } else {
            selectedArea = "";
            loadQuestion();
        }
    }

    function nextQuestion() {
        const totalQuestions = quizData[selectedArea].length;
        if (responses[`q${currentQuestion}`]) {
            if (currentQuestion < totalQuestions - 1) {
                currentQuestion++;
                loadQuestion();
            } else {
                // Última pergunta: exibe mensagem de fechamento e botão de finalizar
                document.getElementById("next-btn").style.display = "none";
                document.getElementById("submit-quiz").style.display = "inline-block";
                const msg = document.getElementById("closing-message");
                msg.style.display = "block";
                msg.scrollIntoView({ behavior: 'smooth', block: 'center' });
            }
        }
    }

    const supabaseClient = (typeof window !== 'undefined' && window.supabase && window.SUPABASE_URL && window.SUPABASE_ANON_KEY)
        ? window.supabase.createClient(window.SUPABASE_URL, window.SUPABASE_ANON_KEY)
        : null;

    function segmentMapping(score) {
        if (score >= 12) return "Alta Prioridade";
        if (score >= 9) return "Prioridade";
        if (score >= 6) return "Observação";
        return "Baixa Prioridade";
    }

    function submitQuiz() {
        if (!responses[`q${currentQuestion}`]) {
            alert("Selecione uma opção antes de finalizar!");
            return;
        }
        // validação do lead
        if (!leadName || !leadEmail) {
            const msg = document.getElementById('lead-gate-msg');
            msg.style.color = '#e74c3c';
            msg.textContent = 'Informe nome e e‑mail antes de concluir.';
            window.scrollTo({ top: 0, behavior: 'smooth' });
            return;
        }

        let iaScore = 0;
        const fearImpact = { "Perda do emprego": 4, "Obsolecência de habilidades": 3, "Falta de tempo para aprendizado": 2, "Outro motivo": 1 };
        const urgencyImpact = { "Imediata": 4, "Nos próximos 6 meses": 3, "Nos próximos 12 meses": 2, "Não urgente": 1 };
        const currentImpact = { "Alto": 4, "Moderado": 3, "Baixo": 2, "Nenhum": 1 };
        const budgetMap = { "Mais de R$300": 4, "Entre R$101 e R$300": 3, "Até R$100": 2, "Nada": 1 };

        const pain = responses.q1;
        const budget = responses.q3;
        const urgency = responses.q4;
        const impactNow = responses.q6;

        iaScore += fearImpact[responses.q1] || 1;
        iaScore += urgencyImpact[urgency] || 1;
        iaScore += currentImpact[impactNow] || 1;
        iaScore = Math.min(12, Math.max(3, iaScore));

        const segmentScore = (fearImpact[pain] || 1) + (budgetMap[budget] || 1) + (urgencyImpact[urgency] || 1) + (currentImpact[impactNow] || 1);
        const segmentGroup = segmentMapping(segmentScore);

        // --- Classificação por Segmento de Cliente (A/B/C) ---
        function includesAny(text, arr){
            const t = (text || '').toLowerCase();
            return arr.some(k => t.includes(k));
        }

        const fear = (responses.q1 || '').toLowerCase();
        const skillLevel = (responses.q2 || responses.q3 || '').toLowerCase(); // depende da área
        const invest = (responses.q3 || responses.q4 || '').toLowerCase();
        const barrier = (responses.q7 || responses.q8 || '').toLowerCase();
        const urgencyStr = (responses.q4 || '').toLowerCase();
        const impactStr = (responses.q6 || '').toLowerCase();

        let segA = 0, segB = 0, segC = 0;
        // Segmento A: Explorador Ansioso
        if (includesAny(fear, ["perda do emprego","automação","automacao","incerteza"])) segA += 2;
        if (includesAny(urgencyStr, ["imediata","próximos 6","proximos 6"])) segA += 2;
        if (includesAny(impactStr, ["alto","moderado"])) segA += 1;
        if (includesAny(barrier, ["falta de tempo","complexidade"])) segA += 1;

        // Segmento B: Especialista Estagnado
        if (includesAny(fear, ["obsolecência","obsolescencia","desvalorização","desvalorizacao"])) segB += 2;
        if (includesAny(invest, ["nada","até r$100","ate r$100"])) segB += 2;
        if (includesAny(skillLevel, ["avançado","avancado","especialista"])) segB += 1;
        if (includesAny(urgencyStr, ["12 meses","não urgente","nao urgente"])) segB += 1;

        // Segmento C: Generalista Confuso
        if (includesAny((responses.q0 || responses.q1 || '').toLowerCase(), ["não utilizo","nao utilizo","outra ferramenta"]) ) segC += 2;
        if (includesAny(barrier, ["falta de motivação","falta de motivacao","complexidade"])) segC += 2;
        if (includesAny(impactStr, ["baixo","nenhum"])) segC += 1;
        if (includesAny(urgencyStr, ["não urgente","nao urgente"])) segC += 1;

        let customerSegment = 'Explorador Ansioso';
        let maxVal = segA; let segKey = 'A';
        if (segB > maxVal) { maxVal = segB; segKey = 'B'; }
        if (segC > maxVal) { maxVal = segC; segKey = 'C'; }
        if (segKey === 'A') customerSegment = 'Explorador Ansioso';
        if (segKey === 'B') customerSegment = 'Especialista Estagnado';
        if (segKey === 'C') customerSegment = 'Generalista Confuso';

        const queryString = `?area=${encodeURIComponent(selectedArea)}&responses=${encodeURIComponent(JSON.stringify(responses))}&iaScore=${encodeURIComponent(iaScore)}&segmentScore=${encodeURIComponent(segmentScore)}&segmentGroup=${encodeURIComponent(segmentGroup)}&customerSegment=${encodeURIComponent(customerSegment)}`;

        // guarda últimos resultados para o opt-in de envio
        lastIaScore = iaScore;
        lastSegmentScore = segmentScore;
        lastSegmentGroup = segmentGroup;
        lastCustomerSegment = customerSegment;

        // Apresenta resultado na página e CTA para relatório (exige e-mail)
        const results = document.getElementById("results-container");
        document.getElementById("score-text").textContent = `Seu Score de Impacto da IA é ${iaScore}/12. Prioridade: ${segmentGroup} (score ${segmentScore}/16). Perfil: ${customerSegment}.`;
        const cta = document.getElementById("report-cta");
        results.style.display = "block";
        results.scrollIntoView({ behavior: 'smooth', block: 'start' });

        // Não redireciona automaticamente; usuário verá o score e poderá clicar no CTA para ir ao formulário

        (async function() {
            if (supabaseClient) {
                try {
                    await supabaseClient.from('quiz_responses').insert({
                        area: selectedArea,
                        responses: responses,
                        ia_score: iaScore,
                        segment_score: segmentScore,
                        segment_group: segmentGroup,
                        customer_segment: customerSegment
                    });
                    // registra lead no início do quiz, se ainda não existir evento
                    try {
                        await supabaseClient.from('leads').insert({ name: leadName, email: leadEmail, area: selectedArea, ia_score: iaScore, segment_score: segmentScore, segment_group: segmentGroup, customer_segment: customerSegment });
                    } catch(_) {}
                    await supabaseClient.from('events').insert({ type: 'submit_quiz', page: 'quiz' });
                } catch (e) {}
            }
        })();
    }

    function startQuizFromLead(){
        const nameEl = document.getElementById('lead-name');
        const emailEl = document.getElementById('lead-email');
        const msg = document.getElementById('lead-gate-msg');
        const name = (nameEl.value || '').trim();
        const email = (emailEl.value || '').trim();
        if (!name || !email || !/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email)){
            msg.style.color = '#e74c3c';
            msg.textContent = 'Preencha nome e um e‑mail válido para começar.';
            return;
        }
        leadName = name; leadEmail = email;
        msg.style.color = '#2ecc71';
        msg.textContent = 'Tudo certo! Vamos começar.';
        // inicia seleção de área
        selectedArea = ""; currentQuestion = 0; responses = {};
        loadQuestion();
        // foca na área
        const qt = document.getElementById('question-title'); if (qt) qt.focus();
    }

    async function sendReportOptIn(){
        const btn = document.getElementById('report-cta');
        btn.disabled = true; btn.textContent = 'Enviando...';
        try {
            if (!supabaseClient){ throw new Error('Cliente Supabase não inicializado'); }
            if (lastIaScore == null){ throw new Error('Finalize o quiz antes de solicitar o relatório'); }
            await supabaseClient.functions.invoke('send-report', {
                body: {
                    name: leadName,
                    email: leadEmail,
                    area: selectedArea,
                    responses,
                    iaScore: lastIaScore,
                    segmentScore: lastSegmentScore,
                    segmentGroup: lastSegmentGroup,
                    customerSegment: lastCustomerSegment
                }
            });
            btn.textContent = 'Relatório solicitado! Verifique seu e‑mail';
        } catch (e){
            btn.disabled = false; btn.textContent = 'Receber relatório por e‑mail';
            alert('Não foi possível enviar o relatório agora. Tente novamente em alguns minutos.');
        }
    }

    // Compartilhamento básico
    function sharePage() {
        if (navigator.share) {
            navigator.share({
                title: 'FutureProof Navigator',
                text: 'Veja meu score de impacto da IA e faça o quiz!',
                url: window.location.href
            }).catch(() => {});
        } else {
            alert('Copie e compartilhe este link: ' + window.location.href);
        }
    }

    // Inicializa quiz
    window.onload = loadQuestion;
</script>

</body>
</html>